{{>layouts/header}}

<style>
    .text-mono { font-variant-numeric: tabular-nums; letter-spacing:-0.01em; }

    .wage-preview-header {
        background: linear-gradient(135deg, #198754 0%, #20c997 100%);
        color:#fff;
        border-bottom:none;
    }
    .wage-preview-card .table > :not(caption) > * > * { padding: 0.9rem 1rem; }
    .wage-preview-table thead th {
        background:#f6f9fb;
        color:#6c757d;
        font-weight:600;
        border-bottom:1px solid #e9ecef;
    }
    .wage-preview-table tbody tr:not(.table-subtle) td { border-top: 1px dashed #eef2f6; }
    .wage-preview-table .table-subtle td { background:#fafcfd; color:#7a8a99; }

    /* ==== ì£¼ê°„ íƒ€ì„í…Œì´ë¸” ì„ íƒ ìŠ¤íƒ€ì¼ ==== */
    .week-grid {
        width: 100%;
        border: 1px solid #e5e7eb;
        border-radius: 10px;
        overflow: hidden;
        user-select: none;
        background:#fff;
    }
    .week-grid table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        table-layout: fixed;
    }
    .week-grid thead th {
        background: #f8fafc;
        color:#64748b;
        font-weight: 600;
        font-size: 0.9rem;
        border-bottom: 1px solid #e5e7eb;
        text-align: center;
        padding: .35rem .25rem;
        position: sticky;
        top: 0;
        z-index: 2;
    }
    .week-grid tbody th {
        background: #fafafa;
        color:#6b7280;
        font-weight: 600;
        width: 74px;
        border-right: 1px solid #e5e7eb;
        text-align: center;
        padding: .25rem .25rem;
        font-size: .85rem;
        position: sticky;
        left: 0;
        z-index: 1;
    }
    .time-slot {
        border-bottom: 1px dashed #eef2f6;
        border-right: 1px dashed #eef2f6;
        height: 18px;
        cursor: pointer;
        background: #ffffff;
    }
    .time-slot:hover { background: #f8fbff; }
    .time-slot.selected {
        background: rgba(25,135,84,.18);
        box-shadow: inset 0 0 0 1px rgba(25,135,84,.25);
    }
    .row-hour-start td, .row-hour-start th { border-top: 2px solid #e5e7eb !important; }
    .timecell { font-variant-numeric: tabular-nums; }

    .grid-toolbar {
        display: flex;
        gap: 8px;
        align-items: center;
        justify-content: space-between;
        margin-bottom: .5rem;
        flex-wrap: wrap;
    }
    .grid-toolbar .left,
    .grid-toolbar .right {
        display: flex;
        gap: 8px;
        align-items: center;
        flex-wrap: wrap;
    }

    .slot-size-group .btn-check + .btn {
        min-width: 70px;
    }

    @media (min-width: 992px){
        .sticky-side { position: sticky; top: 12px; }
    }

    /* ===== ë“±ë¡ ì „ ìš”ì•½ íŒì—… ===== */
    .confirm-modal {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,.35);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1050;
    }
    .confirm-modal .modal-dialog {
        margin: 0 1rem;
        max-width: 720px;
        width: 100%;
    }
    .confirm-modal .modal-content {
        border-radius: 12px;
        box-shadow: 0 20px 40px rgba(15,23,42,.25);
    }
</style>

<main class="container my-4">
    <h2 class="mb-3">ğŸ‘¤ ì•„ë¥´ë°”ì´íŠ¸ íšŒì› ë“±ë¡</h2>

    <form class="container px-0" action="/members/create" method="post" id="memberForm">
        {{#_csrf}}
            <input type="hidden" name="{{parameterName}}" value="{{token}}">
        {{/_csrf}}

        <!-- =================== 1. ê¸°ë³¸ ì •ë³´ =================== -->
        <div class="card mb-3">
            <div class="card-header fw-bold">ê¸°ë³¸ ì •ë³´</div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-sm align-middle mb-0">
                        <thead class="table-light">
                        <tr>
                            <th>ì´ë¦„</th>
                            <th>ì„±ë³„</th>
                            <th>ì—°ë½ì²˜</th>
                            <th>ì´ë©”ì¼</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td>
                                <input class="form-input form-control" type="text" name="name" placeholder="ì´ë¦„" required>
                            </td>
                            <td>
                                <select class="form-select" name="gender" required>
                                    <option value="">ì„ íƒ</option>
                                    <option value="ë‚¨ì„±">ë‚¨ì„±</option>
                                    <option value="ì—¬ì„±">ì—¬ì„±</option>
                                </select>
                            </td>
                            <td>
                                <input
                                        class="form-input form-control"
                                        type="tel"
                                        name="phone"
                                        id="phone"
                                        placeholder="010-1234-5678"
                                        pattern="^0\d{1,2}-\d{3,4}-\d{4}$"
                                        autocomplete="tel"
                                        inputmode="tel"
                                        required>
                            </td>
                            <td>
                                <input class="form-input form-control" type="email" name="email" id="email" placeholder="name@example.com">
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="form-text mt-1">
                    ì—°ë½ì²˜ëŠ” ìˆ«ìë§Œ ì…ë ¥í•´ë„ ìë™ìœ¼ë¡œ <code>010-1234-5678</code> í˜•ì‹ìœ¼ë¡œ í¬ë§·íŒ…ë©ë‹ˆë‹¤. ì´ë©”ì¼ì€ ì„ íƒ ì…ë ¥ì…ë‹ˆë‹¤.
                </div>
            </div>
        </div>

        <!-- =================== 2. ë³´ê±´ì¦ =================== -->
        <div class="card mb-3">
            <div class="card-header fw-bold">ë³´ê±´ì¦</div>
            <div class="card-body">
                <div class="mb-2">
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="hasHealthCertificate" value="true" id="healthYes">
                        <label class="form-check-label" for="healthYes">ë³´ìœ </label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="hasHealthCertificate" value="false" id="healthNo" checked>
                        <label class="form-check-label" for="healthNo">ë¯¸ë³´ìœ </label>
                    </div>
                </div>

                <div id="healthExpiryPanel" class="mt-2" style="display:none;">
                    <div class="d-flex align-items-end gap-2 flex-wrap">
                        <div>
                            <label class="form-label mb-1">ìœ íš¨ê¸°ê°„(ë§Œë£Œì¼)</label>
                            <input type="date" class="form-input form-control" id="healthExpiryDate">
                        </div>
                        <div class="mb-2">
                            <button type="button" class="btn btn-success btn-sm" id="applyHealthExpiry">ì ìš©</button>
                            <button type="button" class="btn btn-secondary btn-sm" id="cancelHealthExpiry">ì·¨ì†Œ</button>
                        </div>
                    </div>
                    <div id="healthExpiryPreview" class="text-muted mt-2">ìœ íš¨ê¸°ê°„ì„ ë“±ë¡í•˜ì„¸ìš”.</div>
                </div>
            </div>
        </div>

        <!-- =================== 3. ê·¼ë¬´ ì¡°ê±´ / ê³„ì¢Œ / ì„¸ê¸ˆ =================== -->
        <div class="card mb-3">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span class="fw-bold">ê·¼ë¬´ ì¡°ê±´ / ê³„ì¢Œ / ì„¸ê¸ˆ</span>
                <select class="form-select form-select-sm w-auto" name="status" required>
                    <option value="">ìƒíƒœ</option>
                    <option value="WAITING" selected>ì‹œì‘ì „</option>
                    <option value="WORKING">ê·¼ë¬´ì¤‘</option>
                    <option value="RESTING">íœ´ì‹ì¤‘</option>
                    <option value="PAUSED">ì¼ì‹œì¤‘ì§€</option>
                    <option value="RESIGNED">í‡´ì‚¬</option>
                </select>
            </div>
            <div class="card-body">
                <!-- ê·¼ë¬´ ì¡°ê±´ í•œ ì¤„ -->
                <div class="table-responsive mb-3">
                    <table class="table table-sm align-middle mb-0">
                        <thead class="table-light">
                        <tr>
                            <th>ì•„ë¥´ë°”ì´íŠ¸ ì‹œì‘ì¼</th>
                            <th>ì‹œê¸‰(ì›)</th>
                            <th>ê¸‰ì—¬ì§€ê¸‰ì¼</th>
                            <th>ì£¼íœ´ìˆ˜ë‹¹</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td>
                                <input class="form-input form-control" type="date" name="startDate" required>
                            </td>
                            <td>
                                <input
                                        class="form-input form-control"
                                        type="number"
                                        name="hourlyWage"
                                        id="hourlyWage"
                                        min="0"
                                        step="10"
                                        placeholder="10030"
                                        required>
                            </td>
                            <td>
                                <select class="form-select" name="payday" id="payday">
                                    <option value="">ì„ íƒ</option>
                                    <option value="EOM">ë§ì¼</option>
                                    <option value="1">1ì¼</option>
                                    <option value="5">5ì¼</option>
                                    <option value="10">10ì¼</option>
                                    <option value="15">15ì¼</option>
                                    <option value="20">20ì¼</option>
                                    <option value="25">25ì¼</option>
                                    <option value="30">30ì¼</option>
                                    <option value="31">31ì¼</option>
                                </select>
                            </td>
                            <td>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="includeWeeklyHolidayAllowance" name="includeWeeklyHolidayAllowance" value="true">
                                    <label class="form-check-label" for="includeWeeklyHolidayAllowance">ì ìš©</label>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <div class="form-text">ê¸‰ì—¬ì§€ê¸‰ì¼ì€ ë§ì¼ ë˜ëŠ” ë‚ ì§œ(1~31ì¼)ë¥¼ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì£¼íœ´ìˆ˜ë‹¹ì€ ê³„ì‚° ëª¨ë“ˆì—ì„œ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
                </div>

                <!-- ì€í–‰/ê³„ì¢Œ + ì„¸ê¸ˆë¶€ê³¼ ì²´í¬ë°•ìŠ¤ -->
                <div class="table-responsive">
                    <table class="table table-sm align-middle mb-0">
                        <thead class="table-light">
                        <tr>
                            <th>ì€í–‰</th>
                            <th>ê³„ì¢Œë²ˆí˜¸</th>
                            <th style="width: 220px;">ì„¸ê¸ˆ/4ëŒ€ë³´í—˜ ì ìš©</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td>
                                <select class="form-select" name="bankName" id="bankName" required>
                                    <option value="">ì„ íƒ</option>
                                    <option>KBêµ­ë¯¼</option><option>ì‹ í•œ</option><option>ìš°ë¦¬</option><option>í•˜ë‚˜</option><option>ë†í˜‘</option>
                                    <option>IBKê¸°ì—…</option><option>ì¹´ì¹´ì˜¤ë±…í¬</option><option>í† ìŠ¤ë±…í¬</option><option>SCì œì¼</option><option>ì”¨í‹°</option>
                                    <option>ë¶€ì‚°</option><option>ëŒ€êµ¬</option><option>ê²½ë‚¨</option><option>ê´‘ì£¼</option><option>ì „ë¶</option>
                                    <option>ìˆ˜í˜‘</option><option>ìƒˆë§ˆì„</option><option>ìš°ì²´êµ­</option>
                                </select>
                            </td>
                            <td>
                                <input
                                        class="form-input form-control"
                                        type="text"
                                        name="bankAccount"
                                        id="bankAccount"
                                        inputmode="numeric"
                                        placeholder="ìˆ«ìë§Œ ì…ë ¥ (ì˜ˆ: 110123456789)"
                                        required>
                            </td>
                            <td>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="applyTax" name="applyTax" value="true">
                                    <label class="form-check-label" for="applyTax">
                                        ì„¸ê¸ˆ/4ëŒ€ë³´í—˜ ê³µì œ ì ìš©
                                    </label>
                                </div>
                                <div class="form-text">
                                    ì²´í¬ ì‹œ ì›ì²œì„¸ ë° 4ëŒ€ë³´í—˜ ê³µì œ ë¡œì§ì„ ì ìš©í•˜ëŠ” í”Œë˜ê·¸ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <div class="form-text">ê³„ì¢Œë²ˆí˜¸ëŠ” ìˆ«ìë§Œ í—ˆìš© Â· 8~20ìë¦¬, í•˜ì´í”ˆ ì—†ì´ ì…ë ¥í•˜ì„¸ìš”.</div>
                </div>
            </div>
        </div>

        <!-- =================== 4. ê·¼ë¬´ì‹œê°„ ì£¼ê°„ ìŠ¤ì¼€ì¤„ =================== -->
        <div class="card mb-3">
            <div class="card-header fw-bold d-flex justify-content-between align-items-center">
                <span>ê·¼ë¬´ì‹œê°„ (ì£¼ê°„ ìŠ¤ì¼€ì¤„)</span>
                <button type="button" class="btn btn-outline-primary btn-sm" id="bulkAddScheduleBtn">ì¼ì • ì„ì‹œì €ì¥</button>
            </div>
            <div class="card-body">

                <!-- íˆ´ë°” -->
                <div class="grid-toolbar mb-2">
                    <div class="left">
                        <div class="btn-group btn-group-sm slot-size-group" role="group" aria-label="Slot size">
                            <input type="radio" class="btn-check" name="slotSize" id="slotSize10" autocomplete="off" value="10" checked>
                            <label class="btn btn-outline-primary" for="slotSize10">10ë¶„</label>

                            <input type="radio" class="btn-check" name="slotSize" id="slotSize30" autocomplete="off" value="30">
                            <label class="btn btn-outline-primary" for="slotSize30">30ë¶„</label>

                            <input type="radio" class="btn-check" name="slotSize" id="slotSize60" autocomplete="off" value="60">
                            <label class="btn btn-outline-primary" for="slotSize60">1ì‹œê°„</label>
                        </div>

                        <button type="button" class="btn btn-sm btn-outline-secondary ms-1" id="clearAll">ì „ì²´ ì´ˆê¸°í™”</button>

                        <div class="input-group input-group-sm" style="max-width: 260px;">
                            <label class="input-group-text">ìš”ì¼ ì´ˆê¸°í™”</label>
                            <select id="clearDaySelect" class="form-select">
                                <option value="">ì„ íƒâ€¦</option>
                                <option value="MON">ì›”</option><option value="TUE">í™”</option><option value="WED">ìˆ˜</option>
                                <option value="THU">ëª©</option><option value="FRI">ê¸ˆ</option><option value="SAT">í† </option><option value="SUN">ì¼</option>
                            </select>
                            <button class="btn btn-outline-danger" type="button" id="clearDayBtn">ì´ˆê¸°í™”</button>
                        </div>
                    </div>
                    <div class="right small text-muted">
                        <span>ê·¸ë¦¬ë“œì—ì„œ ì‹œê°„ ìŠ¬ë¡¯ì„ í´ë¦­/ë“œë˜ê·¸ë¡œ ì„ íƒí•˜ê³ , â€œì¼ì • ì„ì‹œì €ì¥â€ ë²„íŠ¼ìœ¼ë¡œ í•˜ë‹¨ ë¦¬ìŠ¤íŠ¸ì— ë°˜ì˜í•©ë‹ˆë‹¤.</span>
                    </div>
                </div>

                <!-- ì£¼ê°„ ê·¸ë¦¬ë“œ -->
                <div class="week-grid mb-3">
                    <table id="weekGridTable">
                        <thead>
                        <tr>
                            <th style="width:74px;">ì‹œê°„</th>
                            <th data-day="MON">ì›”</th>
                            <th data-day="TUE">í™”</th>
                            <th data-day="WED">ìˆ˜</th>
                            <th data-day="THU">ëª©</th>
                            <th data-day="FRI">ê¸ˆ</th>
                            <th data-day="SAT">í† </th>
                            <th data-day="SUN">ì¼</th>
                        </tr>
                        </thead>
                        <tbody id="weekGridBody">
                        <!-- JSì—ì„œ 06:00~22:00, ì„ íƒëœ ìŠ¬ë¡¯ í¬ê¸°(10/30/60ë¶„) ë‹¨ìœ„ë¡œ ìƒì„± -->
                        </tbody>
                    </table>
                </div>

                <!-- ìµœì¢… ì„ íƒ ê²°ê³¼ (ë³‘í•©ëœ êµ¬ê°„) -->
                <div class="mb-2">
                    <table class="table table-sm mb-0" id="schedulePreviewTable">
                        <thead>
                        <tr><th>ìš”ì¼</th><th>ì‹œì‘</th><th>ì¢…ë£Œ</th></tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>

                <div class="small text-muted">
                    * í•˜ë‹¨ ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€ëœ ìŠ¤ì¼€ì¤„ì´ ì‹¤ì œ ì €ì¥ë˜ëŠ” ê·¼ë¬´ì‹œê°„ì…ë‹ˆë‹¤. (ìˆ¨ì€ í•„ë“œ <code>schedule[i].day/start/end</code> ë¡œ ì „ì†¡)
                </div>
            </div>
        </div>

        <!-- =================== 5. ì˜ˆìƒ ê¸‰ì—¬ ë¯¸ë¦¬ë³´ê¸° =================== -->
        <div class="card wage-preview-card shadow-sm mb-3">
            <div class="card-header wage-preview-header d-flex justify-content-between align-items-center">
                <span class="fw-bold">ì˜ˆìƒ ê¸‰ì—¬ ë¯¸ë¦¬ë³´ê¸°</span>
                <small class="text-white-50">ì£¼ê°„ ìŠ¤ì¼€ì¤„ / ì‹œê¸‰ ê¸°ì¤€ ìë™ ê³„ì‚°</small>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-borderless table-hover align-middle mb-0 wage-preview-table">
                        <thead>
                        <tr><th class="w-50">í•­ëª©</th><th class="text-end w-50">ê°’</th></tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td class="text-muted">ì£¼ê°„ ì´ ê·¼ë¬´ì‹œê°„</td>
                            <td class="text-end text-mono fw-semibold" id="previewWeeklyHours">0ì‹œê°„ 0ë¶„</td>
                        </tr>
                        <tr>
                            <td class="text-muted">ì£¼ê°„ ì˜ˆìƒ ê¸‰ì—¬</td>
                            <td class="text-end text-mono fw-bold" id="previewWeeklyPay">â‚©0</td>
                        </tr>
                        <tr class="table-subtle">
                            <td class="text-muted">ì›” í™˜ì‚° ì£¼ì°¨</td>
                            <td class="text-end text-mono">Ã— 4.345</td>
                        </tr>
                        <tr>
                            <td class="text-muted">ì›”ê°„ ì˜ˆìƒ ê¸‰ì—¬</td>
                            <td class="text-end text-mono fw-bold text-success" id="previewMonthlyPay">â‚©0</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="px-3 pb-3 pt-2 small text-muted">* ì›” í™˜ì‚°ì€ í‰ê·  1ê°œì›” â‰ˆ 4.345ì£¼ ê¸°ì¤€ì…ë‹ˆë‹¤.</div>
            </div>
        </div>

        <!-- =================== 6. ë“±ë¡ ë²„íŠ¼ + ìˆ¨ì€ ì‹¤ì œ submit =================== -->
        <div class="d-grid mb-4">
            <button type="button" class="btn btn-success btn-lg" id="openConfirmModalBtn">ë“±ë¡í•˜ê¸°</button>
            <button type="submit" id="realSubmitBtn" hidden></button>
        </div>
    </form>
</main>

<!-- ===== ë“±ë¡ ì „ ìš”ì•½ íŒì—… ===== -->
<div class="confirm-modal" id="confirmModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title mb-0">ë“±ë¡ ì •ë³´ í™•ì¸</h5>
                <button type="button" class="btn-close" aria-label="ë‹«ê¸°" id="confirmCloseBtn"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <h6 class="fw-bold">ê¸°ë³¸ ì •ë³´</h6>
                    <div class="small">
                        <div><strong>ì´ë¦„:</strong> <span id="summaryName"></span></div>
                        <div><strong>ì„±ë³„:</strong> <span id="summaryGender"></span></div>
                        <div><strong>ì—°ë½ì²˜:</strong> <span id="summaryPhone"></span></div>
                        <div><strong>ì´ë©”ì¼:</strong> <span id="summaryEmail"></span></div>
                    </div>
                </div>
                <div class="mb-3">
                    <h6 class="fw-bold">ë³´ê±´ì¦</h6>
                    <div class="small">
                        <div><strong>ë³´ìœ  ì—¬ë¶€:</strong> <span id="summaryHealthFlag"></span></div>
                        <div><strong>ìœ íš¨ê¸°ê°„:</strong> <span id="summaryHealthExpiry"></span></div>
                    </div>
                </div>
                <div class="mb-3">
                    <h6 class="fw-bold">ê·¼ë¬´ ì¡°ê±´ / ê³„ì¢Œ / ì„¸ê¸ˆ</h6>
                    <div class="small">
                        <div><strong>ìƒíƒœ:</strong> <span id="summaryStatus"></span></div>
                        <div><strong>ì‹œì‘ì¼:</strong> <span id="summaryStartDate"></span></div>
                        <div><strong>ì‹œê¸‰:</strong> <span id="summaryHourlyWage"></span></div>
                        <div><strong>ê¸‰ì—¬ì§€ê¸‰ì¼:</strong> <span id="summaryPayday"></span></div>
                        <div><strong>ì£¼íœ´ìˆ˜ë‹¹:</strong> <span id="summaryWeeklyHoliday"></span></div>
                        <div><strong>ì€í–‰:</strong> <span id="summaryBank"></span></div>
                        <div><strong>ê³„ì¢Œë²ˆí˜¸:</strong> <span id="summaryBankAccount"></span></div>
                        <div><strong>ì„¸ê¸ˆ/4ëŒ€ë³´í—˜ ê³µì œ:</strong> <span id="summaryApplyTax"></span></div>
                    </div>
                </div>
                <div class="mb-0">
                    <h6 class="fw-bold">ì£¼ê°„ ìŠ¤ì¼€ì¤„ ìš”ì•½</h6>
                    <table class="table table-sm mb-0">
                        <thead>
                        <tr><th>ìš”ì¼</th><th>ì‹œì‘</th><th>ì¢…ë£Œ</th></tr>
                        </thead>
                        <tbody id="summaryScheduleBody"></tbody>
                    </table>
                    <div class="small text-muted mt-1">
                        * ìŠ¤ì¼€ì¤„ì€ ìƒë‹¨ "ê·¼ë¬´ì‹œê°„ (ì£¼ê°„ ìŠ¤ì¼€ì¤„)" ì˜ì—­ì—ì„œ ì„¤ì •í•œ ë‚´ìš©ê³¼ ë™ì¼í•©ë‹ˆë‹¤.
                    </div>
                </div>
            </div>
            <div class="modal-footer d-flex justify-content-between">
                <button type="button" class="btn btn-outline-secondary" id="confirmCancelBtn">ì·¨ì†Œ</button>
                <button type="button" class="btn btn-success" id="confirmSubmitBtn">ë“±ë¡</button>
            </div>
        </div>
    </div>
</div>

{{>layouts/footer}}

<script>
    (function() {
        const form = document.getElementById('memberForm');

        /* ===== ì „í™”ë²ˆí˜¸ ìë™ í¬ë§· ===== */
        const phone = document.getElementById('phone');

        function formatPhone(raw) {
            let v = String(raw || '').replace(/\D/g, ''); // ìˆ«ìë§Œ
            if (!v) return '';

            // 02 ì§€ì—­ë²ˆí˜¸
            if (v.startsWith('02')) {
                if (v.length <= 2) return v;
                if (v.length <= 6) {
                    return v.replace(/(02)(\d{0,4})/, '$1-$2');
                }
                return v.replace(/(02)(\d{3,4})(\d{0,4}).*/, '$1-$2-$3');
            }

            // 010, 031 ë“±
            if (v.length <= 3) return v;
            if (v.length <= 7) {
                return v.replace(/(0\d{2})(\d{0,4})/, '$1-$2');
            }
            return v.replace(/(0\d{2})(\d{3,4})(\d{0,4}).*/, '$1-$2-$3');
        }

        function isValidPhone(s) {
            return /^(0\d{1,2})-\d{3,4}-\d{4}$/.test(s);
        }

        if (phone) {
            phone.addEventListener('input', () => {
                const prev = phone.value;
                const cursor = phone.selectionStart ?? prev.length;
                const formatted = formatPhone(prev);
                phone.value = formatted;

                const diff = formatted.length - prev.length;
                const nextPos = Math.max(0, cursor + diff);
                try { phone.setSelectionRange(nextPos, nextPos); } catch (e) {}
                phone.setCustomValidity('');
            });

            phone.addEventListener('blur', () => {
                phone.value = formatPhone(phone.value);
                if (phone.value && !isValidPhone(phone.value)) {
                    phone.setCustomValidity('ì˜ˆ: 010-1234-5678 í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•˜ì„¸ìš”.');
                    phone.reportValidity();
                } else {
                    phone.setCustomValidity('');
                }
            });
        }

        /* ===== ê³„ì¢Œ: ìˆ«ìë§Œ í—ˆìš© ===== */
        const bankAccount = document.getElementById('bankAccount');
        if (bankAccount) {
            bankAccount.addEventListener('input', () => {
                const prev = bankAccount.value;
                const cursor = bankAccount.selectionStart ?? prev.length;

                const cleaned = prev.replace(/\D/g, '').slice(0, 20);
                bankAccount.value = cleaned;

                const diff = cleaned.length - prev.length;
                const nextPos = Math.max(0, cursor + diff);
                try { bankAccount.setSelectionRange(nextPos, nextPos); } catch (e) {}

                bankAccount.setCustomValidity('');
            });
        }

        /* ===== ë³´ê±´ì¦ ì¸ë¼ì¸ í¼ ===== */
        const healthYes = document.getElementById('healthYes');
        const healthNo  = document.getElementById('healthNo');
        const panel     = document.getElementById('healthExpiryPanel');
        const dateInput = document.getElementById('healthExpiryDate');
        const applyHealthBtn  = document.getElementById('applyHealthExpiry');
        const cancelHealthBtn = document.getElementById('cancelHealthExpiry');
        const previewText     = document.getElementById('healthExpiryPreview');
        const HFLAG = 'data-health-expiry';

        function onHealthRadioChange() {
            if (healthYes.checked) {
                panel.style.display = 'block';
                const existing = form.querySelector('input[type="hidden"][name="healthCertExpiry"]');
                if (existing && existing.value) {
                    dateInput.value = existing.value;
                    previewText.textContent = `ìœ íš¨ê¸°ê°„: ${existing.value}`;
                    previewText.classList.remove('text-muted');
                } else {
                    dateInput.value = '';
                    previewText.textContent = 'ìœ íš¨ê¸°ê°„ì„ ë“±ë¡í•˜ì„¸ìš”.';
                    previewText.classList.add('text-muted');
                }
            } else {
                panel.style.display = 'none';
                form.querySelectorAll(`input[${HFLAG}="1"]`).forEach(n => n.remove());
                dateInput.value = '';
                previewText.textContent = 'ë³´ìœ  ì„ íƒ ì‹œ ìœ íš¨ê¸°ê°„ì„ ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
                previewText.classList.add('text-muted');
            }
        }

        healthYes.addEventListener('change', onHealthRadioChange);
        healthNo.addEventListener('change', onHealthRadioChange);
        onHealthRadioChange();

        applyHealthBtn.addEventListener('click', () => {
            const val = dateInput.value;
            if (!val) {
                alert('ìœ íš¨ê¸°ê°„(ë§Œë£Œì¼)ì„ ì„ íƒí•˜ì„¸ìš”.');
                return;
            }
            const today = new Date().toISOString().slice(0,10);
            if (val < today && !confirm('ì„ íƒí•œ ë‚ ì§œê°€ ì´ë¯¸ ì§€ë‚¬ìŠµë‹ˆë‹¤. ê·¸ëŒ€ë¡œ ì ìš©í• ê¹Œìš”?')) return;

            form.querySelectorAll(`input[${HFLAG}="1"]`).forEach(n=>n.remove());
            const hidden = document.createElement('input');
            hidden.type = 'hidden';
            hidden.name = 'healthCertExpiry';
            hidden.value = val;
            hidden.setAttribute(HFLAG,'1');
            form.appendChild(hidden);

            previewText.textContent = `ìœ íš¨ê¸°ê°„: ${val}`;
            previewText.classList.remove('text-muted');
        });

        cancelHealthBtn.addEventListener('click', () => {
            const existing = form.querySelector('input[type="hidden"][name="healthCertExpiry"]');
            if (existing && existing.value) {
                dateInput.value = existing.value;
                previewText.textContent = `ìœ íš¨ê¸°ê°„: ${existing.value}`;
                previewText.classList.remove('text-muted');
            } else {
                dateInput.value = '';
                previewText.textContent = 'ìœ íš¨ê¸°ê°„ì„ ë“±ë¡í•˜ì„¸ìš”.';
                previewText.classList.add('text-muted');
            }
        });

        /* ===== ê·¼ë¬´ì‹œê°„: ì£¼ê°„ ê·¸ë¦¬ë“œ & ìŠ¤ì¼€ì¤„ ìƒíƒœ ===== */
        const weekGridBody = document.getElementById('weekGridBody');
        const schedulePreviewBody = document.querySelector('#schedulePreviewTable tbody');

        const dayMap   = { MON:'ì›”', TUE:'í™”', WED:'ìˆ˜', THU:'ëª©', FRI:'ê¸ˆ', SAT:'í† ', SUN:'ì¼' };
        const daysOrder = ['MON','TUE','WED','THU','FRI','SAT','SUN'];

        const HOUR_START = 6;
        const HOUR_END   = 22;

        let stepMin = 10; // 10 / 30 / 60

        // ìš”ì¼ë³„ ìŠ¤ì¼€ì¤„ ìƒíƒœ: [startMin, endMin] ë°°ì—´ (endMinì€ ë¯¸í¬í•¨ ìƒí•œ)
        const schedules = {
            MON: [], TUE: [], WED: [], THU: [], FRI: [], SAT: [], SUN: []
        };

        const slotSizeRadios = document.querySelectorAll('input[name="slotSize"]');
        const bulkAddBtn = document.getElementById('bulkAddScheduleBtn');

        function updateScheduleButtonsState() {
            const enable = (stepMin === 10);
            if (bulkAddBtn) bulkAddBtn.disabled = !enable;
        }

        slotSizeRadios.forEach(radio => {
            radio.addEventListener('change', () => {
                if (!radio.checked) return;
                const newStep = parseInt(radio.value, 10);
                if (newStep === stepMin) return;
                stepMin = newStep;
                buildWeekGrid();
                // ê·¸ë¦¬ë“œ ì„ íƒì€ ì´ˆê¸°í™” (ê¸°ì¡´ ìŠ¤ì¼€ì¤„ì€ ìœ ì§€)
                clearAllGridSelection();
                // ìŠ¤ì¼€ì¤„ ê¸°ë°˜ ê¸‰ì—¬ ì¬ê³„ì‚°
                rebuildPreviewFromSchedules();
                updatePreview();
                updateScheduleButtonsState();
            });
        });

        function buildWeekGrid() {
            const START_MIN = HOUR_START * 60;
            const END_MIN   = HOUR_END   * 60;
            const totalRows = (END_MIN - START_MIN) / stepMin;

            weekGridBody.innerHTML = '';

            for (let idx = 0; idx < totalRows; idx++) {
                const tMin = START_MIN + idx * stepMin;
                const h = Math.floor(tMin / 60);
                const m = tMin % 60;
                const hmLabel = `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}`;

                const tr = document.createElement('tr');
                if (m === 0) tr.classList.add('row-hour-start');

                const th = document.createElement('th');
                th.className = 'timecell';
                th.textContent = (m % 30 === 0) ? hmLabel : '';
                tr.appendChild(th);

                daysOrder.forEach(day => {
                    const td = document.createElement('td');
                    const div = document.createElement('div');
                    div.className = 'time-slot';
                    div.dataset.day = day;
                    div.dataset.idx = String(idx);
                    td.appendChild(div);
                    tr.appendChild(td);
                });

                weekGridBody.appendChild(tr);
            }
            attachDragHandlers();
        }

        /* ===== ë“œë˜ê·¸ ì„ íƒ/í•´ì œ ===== */
        let dragging = false;
        let dragAdding = true;

        function attachDragHandlers() {
            weekGridBody.querySelectorAll('.time-slot').forEach(div => {
                div.addEventListener('mousedown', (e) => {
                    e.preventDefault();
                    dragging = true;
                    dragAdding = !div.classList.contains('selected');
                    toggleSlot(div, dragAdding);
                });
                div.addEventListener('mouseenter', () => {
                    if (!dragging) return;
                    toggleSlot(div, dragAdding);
                });
            });
            window.addEventListener('mouseup', () => {
                if (dragging) {
                    dragging = false;
                }
            });
        }

        function toggleSlot(el, on) {
            on ? el.classList.add('selected') : el.classList.remove('selected');
        }

        function clearAllGridSelection() {
            weekGridBody.querySelectorAll('.time-slot.selected').forEach(s => s.classList.remove('selected'));
        }

        /* ===== ì „ì²´/ìš”ì¼ ì´ˆê¸°í™” (ê·¸ë¦¬ë“œë§Œ) ===== */
        const clearAllBtn    = document.getElementById('clearAll');
        const clearDayBtn    = document.getElementById('clearDayBtn');
        const clearDaySelect = document.getElementById('clearDaySelect');

        clearAllBtn.addEventListener('click', () => {
            clearAllGridSelection();
        });

        clearDayBtn.addEventListener('click', () => {
            const d = clearDaySelect.value;
            if (!d) return;
            weekGridBody.querySelectorAll(`.time-slot[data-day="${d}"].selected`).forEach(s => s.classList.remove('selected'));
        });

        /* ===== ì‹œê°„ ë¬¸ìì—´/ë¶„ ë³€í™˜ ===== */
        function hmToMin(hm){
            const [H,M] = String(hm).split(':').map(Number);
            return (H || 0)*60 + (M || 0);
        }
        function minToHM(min){
            const H = Math.floor(min/60), M = min%60;
            return `${String(H).padStart(2,'0')}:${String(M).padStart(2,'0')}`;
        }

        /* ===== ì—°ì† ìŠ¬ë¡¯ ë³‘í•© (index ë°°ì—´ â†’ [startIdx, endIdx]) ===== */
        function mergeConsecutiveIndexes(arr) {
            const out = [];
            if (!arr.length) return out;
            arr.sort((a,b) => a - b);
            let s = arr[0], p = arr[0];
            for (let i = 1; i < arr.length; i++) {
                if (arr[i] === p + 1) {
                    p = arr[i];
                    continue;
                }
                out.push([s, p]);
                s = p = arr[i];
            }
            out.push([s, p]);
            return out;
        }

        /* ===== Interval ë³‘í•© (ë¶„ ë‹¨ìœ„ [startMin,endMin]) ===== */
        function mergeIntervals(existing, added) {
            const all = existing.concat(added);
            if (!all.length) return [];
            all.sort((a,b) => a[0] - b[0]);
            const res = [ all[0].slice() ];
            for (let i = 1; i < all.length; i++) {
                const last = res[res.length - 1];
                const cur  = all[i];
                if (cur[0] <= last[1]) { // ê²¹ì¹˜ê±°ë‚˜ ë¶™ì–´ìˆìœ¼ë©´ ë³‘í•©
                    last[1] = Math.max(last[1], cur[1]);
                } else {
                    res.push(cur.slice());
                }
            }
            return res;
        }

        /* ===== ìŠ¤ì¼€ì¤„ ìƒíƒœ â†’ í•˜ë‹¨ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§ ===== */
        function rebuildPreviewFromSchedules() {
            schedulePreviewBody.innerHTML = '';
            let hasAny = false;

            daysOrder.forEach(day => {
                const intervals = schedules[day];
                intervals.forEach(([sMin, eMin]) => {
                    hasAny = true;
                    const tr = document.createElement('tr');
                    const startHM = minToHM(sMin);
                    const endHM   = minToHM(eMin);
                    tr.innerHTML = `
                        <td data-day="${day}">${dayMap[day]}(${day})</td>
                        <td data-start="${startHM}">${startHM}</td>
                        <td data-end="${endHM}">${endHM}</td>
                    `;
                    schedulePreviewBody.appendChild(tr);
                });
            });

            if (!hasAny) {
                const tr = document.createElement('tr');
                tr.setAttribute('data-placeholder','1');
                tr.innerHTML = `<td colspan="3" class="text-muted">ì¶”ê°€ëœ ê·¼ë¬´ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤. ê·¸ë¦¬ë“œë¥¼ ì„ íƒ í›„ "ì¼ì • ì„ì‹œì €ì¥" ë²„íŠ¼ì„ ì‚¬ìš©í•˜ì„¸ìš”.</td>`;
                schedulePreviewBody.appendChild(tr);
            }
        }

        /* ===== ê·¸ë¦¬ë“œ ì„ íƒ â†’ ìŠ¤ì¼€ì¤„ ìƒíƒœì— ë°˜ì˜ (ì¶”ê°€/ë³‘í•©) ===== */
        function appendFromSelection() {
            const START_MIN = HOUR_START * 60;

            // dayë³„ ì„ íƒ index ìˆ˜ì§‘
            const selectedIndexMap = {};
            daysOrder.forEach(d => selectedIndexMap[d] = []);

            weekGridBody.querySelectorAll('.time-slot.selected').forEach(el => {
                const d = el.dataset.day;
                selectedIndexMap[d].push(parseInt(el.dataset.idx, 10));
            });

            let addedSomething = false;

            daysOrder.forEach(day => {
                const idxArr = selectedIndexMap[day];
                if (!idxArr.length) return;

                // index â†’ [startIdx,endIdx] êµ¬ê°„
                const mergedIdx = mergeConsecutiveIndexes(idxArr);

                // indexêµ¬ê°„ â†’ ë¶„ë‹¨ìœ„ interval
                const newIntervals = mergedIdx.map(([sIdx, eIdx]) => {
                    const startMin = START_MIN + sIdx * stepMin;
                    const endMin   = START_MIN + (eIdx + 1) * stepMin;
                    return [startMin, endMin];
                });

                // ê¸°ì¡´ ìŠ¤ì¼€ì¤„ê³¼ ë³‘í•© (Union)
                schedules[day] = mergeIntervals(schedules[day], newIntervals);
                addedSomething = true;
            });

            if (!addedSomething) {
                alert('ì„ íƒëœ ì‹œê°„ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // ìš”êµ¬ì‚¬í•­: ê·¸ë¦¬ë“œ ì„ íƒ ìƒíƒœëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€
            // (ì•„ë¬´ ê²ƒë„ í•´ì œí•˜ì§€ ì•ŠìŒ)

            // í•˜ë‹¨ ë¦¬ìŠ¤íŠ¸ ë° ê¸‰ì—¬/hidden í•„ë“œ ê°±ì‹ 
            rebuildPreviewFromSchedules();
            updatePreview();
        }

        /* ===== ì¼ì • ì„ì‹œì €ì¥ (10ë¶„ ë‹¨ìœ„ì—ì„œë§Œ í™œì„±) ===== */
        if (bulkAddBtn) {
            bulkAddBtn.addEventListener('click', () => {
                if (stepMin !== 10) return; // ì•ˆì „ì¥ì¹˜
                appendFromSelection();      // ì„ íƒëœ ê·¸ë¦¬ë“œ ì „ì²´ë¥¼ ìš”ì¼ë³„ë¡œ ë°˜ì˜
            });
        }

        /* ===== ì˜ˆìƒ ê¸‰ì—¬ ë¯¸ë¦¬ë³´ê¸° (ìŠ¤ì¼€ì¤„ ìƒíƒœ ê¸°ì¤€) ===== */
        const hourlyWage = document.getElementById('hourlyWage');
        const weeklyHoursEl = document.getElementById('previewWeeklyHours');
        const weeklyPayEl   = document.getElementById('previewWeeklyPay');
        const monthlyPayEl  = document.getElementById('previewMonthlyPay');

        if (hourlyWage) {
            hourlyWage.addEventListener('blur', updatePreview);
            hourlyWage.addEventListener('input', updatePreview);
        }

        function computeWeeklyMinutesFromSchedules() {
            let total = 0;
            daysOrder.forEach(day => {
                schedules[day].forEach(([sMin, eMin]) => {
                    total += Math.max(0, eMin - sMin);
                });
            });
            return total;
        }

        function formatKRW(n) {
            return new Intl.NumberFormat('ko-KR',{
                style:'currency',
                currency:'KRW',
                maximumFractionDigits:0
            }).format(n || 0);
        }

        function updatePreview() {
            const totalMin = computeWeeklyMinutesFromSchedules();
            const wage = parseInt(String(hourlyWage?.value || '0').replace(/,/g,''), 10) || 0;

            const h = Math.floor(totalMin / 60);
            const m = totalMin % 60;
            weeklyHoursEl.textContent = `${h}ì‹œê°„ ${m}ë¶„`;

            const weeklyPay = Math.round((totalMin / 60) * wage);
            weeklyPayEl.textContent   = formatKRW(weeklyPay);

            const monthlyPay = Math.round(weeklyPay * 4.345);
            monthlyPayEl.textContent  = formatKRW(monthlyPay);
        }

        /* ===== ìŠ¤ì¼€ì¤„ íˆë“ í•„ë“œ ìƒì„± (schedules ê¸°ì¤€) ===== */
        function rebuildHiddenInputsFromSchedules() {
            form.querySelectorAll('input[data-schedule="1"]').forEach(n => n.remove());

            let idx = 0;
            daysOrder.forEach(day => {
                schedules[day].forEach(([sMin, eMin]) => {
                    const s = minToHM(sMin);
                    const e = minToHM(eMin);
                    addHidden(`schedule[${idx}].day`, day);
                    addHidden(`schedule[${idx}].start`, s);
                    addHidden(`schedule[${idx}].end`, e);
                    idx++;
                });
            });
        }

        function addHidden(name, value) {
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = name;
            input.value = value;
            input.setAttribute('data-schedule','1');
            form.appendChild(input);
        }

        /* ===== ì œì¶œ ì „ ê²€ì¦ ===== */
        form.addEventListener('submit', (e) => {
            // ì „í™”ë²ˆí˜¸
            if (phone) {
                phone.value = formatPhone(phone.value);
                if (!isValidPhone(phone.value)) {
                    e.preventDefault();
                    phone.setCustomValidity('ì˜ˆ: 010-1234-5678 í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•˜ì„¸ìš”.');
                    phone.reportValidity();
                    return;
                } else {
                    phone.setCustomValidity('');
                }
            }

            // ê³„ì¢Œ ê¸¸ì´ ê²€ì¦
            if (bankAccount) {
                const acct = (bankAccount.value || '').replace(/\D/g,'');
                if (acct.length < 8 || acct.length > 20) {
                    e.preventDefault();
                    bankAccount.setCustomValidity('ê³„ì¢Œë²ˆí˜¸ëŠ” ìˆ«ì 8~20ìë¦¬ë¡œ ì…ë ¥í•˜ì„¸ìš” (í•˜ì´í”ˆ ì—†ì´).');
                    bankAccount.reportValidity();
                    return;
                } else {
                    bankAccount.setCustomValidity('');
                }
            }

            // ë³´ê±´ì¦ ê²½ê³ 
            if (healthYes.checked) {
                const hidden = form.querySelector('input[name="healthCertExpiry"]');
                if (!hidden && !confirm('ë³´ê±´ì¦ â€œë³´ìœ â€ë¡œ ì„ íƒí•˜ì…¨ìŠµë‹ˆë‹¤. ìœ íš¨ê¸°ê°„ ì—†ì´ ê³„ì† ì§„í–‰í• ê¹Œìš”?')) {
                    e.preventDefault();
                    return;
                }
            }

            // ìŠ¤ì¼€ì¤„ íˆë“ í•„ë“œ ìµœì‹ í™”
            rebuildHiddenInputsFromSchedules();
        });

        /* ===== ë“±ë¡ ì „ ìš”ì•½ íŒì—… ===== */
        const confirmModal = document.getElementById('confirmModal');
        const confirmCloseBtn = document.getElementById('confirmCloseBtn');
        const confirmCancelBtn = document.getElementById('confirmCancelBtn');
        const confirmSubmitBtn = document.getElementById('confirmSubmitBtn');
        const openConfirmModalBtn = document.getElementById('openConfirmModalBtn');
        const realSubmitBtn = document.getElementById('realSubmitBtn');

        function fillSummaryModal() {
            const nameEl   = form.elements['name'];
            const genderEl = form.elements['gender'];
            const phoneEl  = form.elements['phone'];
            const emailEl  = form.elements['email'];
            const statusEl = form.elements['status'];
            const startEl  = form.elements['startDate'];
            const wageEl   = form.elements['hourlyWage'];
            const paydayEl = form.elements['payday'];
            const bankEl   = form.elements['bankName'];
            const applyTaxEl = form.elements['applyTax'];

            document.getElementById('summaryName').textContent = nameEl?.value || '';
            document.getElementById('summaryGender').textContent =
                    genderEl && genderEl.options[genderEl.selectedIndex] ? genderEl.options[genderEl.selectedIndex].text : '';
            document.getElementById('summaryPhone').textContent = phoneEl?.value || '';
            document.getElementById('summaryEmail').textContent = emailEl?.value || '';

            const hasHealth = healthYes.checked ? 'ë³´ìœ ' : 'ë¯¸ë³´ìœ ';
            document.getElementById('summaryHealthFlag').textContent = hasHealth;
            const healthHidden = form.querySelector('input[name="healthCertExpiry"]');
            document.getElementById('summaryHealthExpiry').textContent =
                    healthHidden?.value || (healthYes.checked ? 'ë¯¸ì…ë ¥' : '-');

            document.getElementById('summaryStatus').textContent =
                    statusEl && statusEl.options[statusEl.selectedIndex] ? statusEl.options[statusEl.selectedIndex].text : '';

            document.getElementById('summaryStartDate').textContent = startEl?.value || '';

            const wageVal = wageEl?.value ? parseInt(wageEl.value,10) : 0;
            document.getElementById('summaryHourlyWage').textContent =
                    wageVal ? formatKRW(wageVal) + ' / ì‹œê°„' : '';

            let paydayText = '';
            if (paydayEl && paydayEl.value) {
                if (paydayEl.value === 'EOM') paydayText = 'ë§ì¼';
                else paydayText = `${paydayEl.value}ì¼`;
            } else {
                paydayText = '-';
            }
            document.getElementById('summaryPayday').textContent = paydayText;

            const weeklyHoliday = document.getElementById('includeWeeklyHolidayAllowance');
            document.getElementById('summaryWeeklyHoliday').textContent =
                    weeklyHoliday && weeklyHoliday.checked ? 'ì ìš©' : 'ë¯¸ì ìš©';

            document.getElementById('summaryBank').textContent =
                    bankEl && bankEl.options[bankEl.selectedIndex] ? bankEl.options[bankEl.selectedIndex].text : '';

            document.getElementById('summaryBankAccount').textContent = bankAccount?.value || '';

            document.getElementById('summaryApplyTax').textContent =
                    applyTaxEl && applyTaxEl.checked ? 'ì ìš©' : 'ë¯¸ì ìš©';

            // ìŠ¤ì¼€ì¤„ ìš”ì•½ì€ í˜„ì¬ preview í…Œì´ë¸” ê·¸ëŒ€ë¡œ ë³µì‚¬
            const summaryScheduleBody = document.getElementById('summaryScheduleBody');
            summaryScheduleBody.innerHTML = schedulePreviewBody.innerHTML;
        }

        function openConfirmModal() {
            // ì „í™”ë²ˆí˜¸ í¬ë§· ì •ë¦¬ í›„ ê¸°ë³¸ HTML5 ê²€ì¦
            if (phone) phone.value = formatPhone(phone.value);
            if (!form.reportValidity()) return;

            rebuildHiddenInputsFromSchedules();
            fillSummaryModal();
            confirmModal.style.display = 'flex';
        }

        function closeConfirmModal() {
            confirmModal.style.display = 'none';
        }

        if (openConfirmModalBtn) {
            openConfirmModalBtn.addEventListener('click', openConfirmModal);
        }
        if (confirmCloseBtn) confirmCloseBtn.addEventListener('click', closeConfirmModal);
        if (confirmCancelBtn) confirmCancelBtn.addEventListener('click', closeConfirmModal);

        confirmModal.addEventListener('click', (e) => {
            if (e.target === confirmModal) {
                closeConfirmModal();
            }
        });

        if (confirmSubmitBtn) {
            confirmSubmitBtn.addEventListener('click', () => {
                closeConfirmModal();
                realSubmitBtn.click(); // ì‹¤ì œ submit íŠ¸ë¦¬ê±°
            });
        }

        // ì´ˆê¸° ê·¸ë¦¬ë“œ ë° ë¯¸ë¦¬ë³´ê¸°
        buildWeekGrid();
        rebuildPreviewFromSchedules(); // ì´ˆê¸°ì—” placeholder
        updatePreview();
        updateScheduleButtonsState();
    })();
</script>
