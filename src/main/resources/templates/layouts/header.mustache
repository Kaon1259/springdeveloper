<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Cafe Friends Manager</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
          rel="stylesheet" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            crossorigin="anonymous"></script>

    <!-- main.css -->
    <link rel="stylesheet" href="/css/main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Noto Sans KR', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        /* 상단 헤더 전체 스타일 */
        .app-navbar {
            background: linear-gradient(135deg, #ffffff, #fff7ec);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            min-height: 64px;
        }

        .app-navbar .navbar-brand img {
            height: 32px;
            width: auto;
        }

        .app-navbar .navbar-brand span {
            font-size: 1.1rem;
            letter-spacing: 0.03em;
            color: #4b3426;
        }

        /* 상위 메뉴(1줄째) */
        .main-menu .nav-link {
            font-size: 0.95rem;
            padding-top: 0.4rem;
            padding-bottom: 0.4rem;
            margin-right: 0.25rem;
            color: #5c5c5c;
            position: relative;
            transition: color 0.15s ease-out;
        }

        .main-menu .nav-link::after {
            content: "";
            position: absolute;
            left: 10%;
            right: 10%;
            bottom: 0;
            height: 2px;
            background-color: transparent;
            border-radius: 999px;
            transition: background-color 0.15s ease-out, transform 0.15s ease-out;
            transform: scaleX(0);
            transform-origin: center;
        }

        .main-menu .nav-link:hover {
            color: #8b4a24;
        }

        .main-menu .nav-link:hover::after {
            background-color: #d48a4c;
            transform: scaleX(1);
        }

        .main-menu .nav-link.active {
            color: #8b4a24;
            font-weight: 600;
        }

        .main-menu .nav-link.active::after {
            background-color: #c76a2d;
            transform: scaleX(1);
        }

        /* 오른쪽 기타 메뉴(Greeting / Good Bye / Quote...) */
        .navbar-nav.ms-auto .nav-link {
            font-size: 0.9rem;
            color: #7a7a7a;
        }

        .navbar-nav.ms-auto .nav-link:hover {
            color: #8b4a24;
        }

        /* 2번째 라인(서브메뉴) 스타일 */
        .submenu-row {
            border-top: 1px solid rgba(0,0,0,.05);
            background-color: rgba(255, 248, 238, 0.7);
        }

        .submenu-row .nav-link {
            font-size: 0.85rem;
            padding-top: 0.25rem;
            padding-bottom: 0.25rem;
            padding-left: 0.75rem;
            padding-right: 0.75rem;
            margin-right: 0.25rem;
            border-radius: 999px;
            color: #5b4637;
            transition: background-color 0.15s ease-out, color 0.15s ease-out;
        }

        .submenu-row .nav-link:hover {
            background-color: rgba(215, 153, 93, 0.12);
            color: #8b4a24;
        }

        @media (max-width: 991.98px) {
            .submenu-row .navbar-nav {
                padding-bottom: 0.5rem;
            }
        }
    </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-light app-navbar fixed-top shadow-sm">
    <div class="container-fluid">

        <!-- 로고: /img/logo.png 사용 -->
        <a class="navbar-brand d-flex align-items-center" href="/" aria-label="Home" title="Home">
            <img src="/img/logo.png" alt="Cafe Friends Manager Logo" class="me-2">
            <span class="fw-bold d-none d-sm-inline">Cafe Friends Manager</span>
        </a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarMenu" aria-controls="navbarMenu"
                aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarMenu">
            <div class="w-100 d-flex flex-column">

                <!-- ===== 1줄째: 상위 메뉴 라인 ===== -->
                <div class="d-flex w-100">
                    <ul class="navbar-nav me-auto align-items-center flex-wrap main-menu">
                        <li class="nav-item">
                            <a class="nav-link" href="/members/realtimedashboard">실시간현황</a>
                        </li>

                        <!-- 일정 상위 메뉴 -->
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="scheduleMenuLink">
                                일정
                            </a>
                        </li>
                        <!-- 근무시간 상위 메뉴 -->
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="workMenuLink">
                                근무시간
                            </a>
                        </li>
                        <!-- 급여 상위 메뉴 -->
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="payMenuLink">
                                급여
                            </a>
                        </li>
                        <!-- 근무자 상위 메뉴 -->
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="memberMenuLink">
                                근무자
                            </a>
                        </li>
                    </ul>

                    <ul class="navbar-nav ms-auto flex-wrap">
                        <li class="nav-item">
                            <a class="nav-link" href="/greetings">Greeting</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/goodbye">Good Bye</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/quote">Quote...</a>
                        </li>
                    </ul>
                </div>

                <!-- ===== 2줄째: 일정 하위 메뉴 ===== -->
                <div id="scheduleSubmenuRow" class="submenu-row w-100 d-none">
                    <ul class="navbar-nav me-auto flex-row flex-wrap mt-1">
                        <li class="nav-item">
                            <a class="nav-link" href="/members/schedulemanagementbyweek">주간일정</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/members/schedulemanagement">월간일정</a>
                        </li>
                    </ul>
                </div>
                <!-- ===== 2줄째: 근무시간 하위 메뉴 ===== -->
                <div id="workSubmenuRow" class="submenu-row w-100 d-none">
                    <ul class="navbar-nav me-auto flex-row flex-wrap mt-1">
                        <li class="nav-item">
                            <a class="nav-link" href="/members/showworktimedashboard">(주간)조회</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/members/showworkmonthdashboard">(월간)조회</a>
                        </li>
                    </ul>
                </div>
                <!-- ===== 2줄째: 급여 하위 메뉴 ===== -->
                <div id="paySubmenuRow" class="submenu-row w-100 d-none">
                    <ul class="navbar-nav me-auto flex-row flex-wrap mt-1">
                        <li class="nav-item">
                            <a class="nav-link" href="/payment">(개별)급여관리</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/payment/paymanagerdashboard">급여관리현황</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/payment/payid">(개별)지급현황</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/payment/payiddashboard">(전체)지급현황</a>
                        </li>
                    </ul>
                </div>
                <!-- ===== 2줄째: 근무자 하위 메뉴 ===== -->
                <div id="memberSubmenuRow" class="submenu-row w-100 d-none">
                    <ul class="navbar-nav me-auto flex-row flex-wrap mt-1">
                        <li class="nav-item">
                            <a class="nav-link" href="/members">조회</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/members/new">신규등록</a>
                        </li>
                    </ul>
                </div>
                <!-- ===== 2줄째 끝 ===== -->

            </div>
        </div>
    </div>
</nav>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const scheduleMenuLink = document.getElementById('scheduleMenuLink');
        const payMenuLink      = document.getElementById('payMenuLink');
        const workMenuLink     = document.getElementById('workMenuLink');
        const memberMenuLink   = document.getElementById('memberMenuLink');

        const scheduleSubmenuRow = document.getElementById('scheduleSubmenuRow');
        const paySubmenuRow      = document.getElementById('paySubmenuRow');
        const workSubmenuRow     = document.getElementById('workSubmenuRow');
        const memberSubmenuRow   = document.getElementById('memberSubmenuRow');

        const mainMenuLinks = document.querySelectorAll('.main-menu .nav-link');
        const navContainer  = document.querySelector('.navbar .container-fluid');

        if (!scheduleMenuLink || !payMenuLink || !workMenuLink || !memberMenuLink) return;

        const path = window.location.pathname || '';

        function positionSubmenu(row, anchor) {
            if (!row || !anchor) return;
            const ul = row.querySelector('ul');
            if (!ul) return;

            const anchorRect = anchor.getBoundingClientRect();
            const containerRect = navContainer
                    ? navContainer.getBoundingClientRect()
                    : { left: 0 };

            const offset = anchorRect.left - containerRect.left;

            ul.style.marginLeft = offset + 'px';
        }

        function resetSubmenuPositions() {
            [scheduleSubmenuRow, paySubmenuRow, workSubmenuRow, memberSubmenuRow].forEach(row => {
                if (!row) return;
                const ul = row.querySelector('ul');
                if (ul) ul.style.marginLeft = '';
            });
        }

        const isSchedulePage =
                path.startsWith('/members/schedulemanagementbyweek') ||
                path.startsWith('/members/schedulemanagement');

        const isPayPage =
                path.startsWith('/payment');

        const isWorkPage =
                path.startsWith('/members/registerworkingtime') ||
                path.startsWith('/members/showworktimedashboard') ||
                path.startsWith('/members/showworkmonthdashboard');

        const isMemberPage =
                path === '/members' ||
                path.startsWith('/members/new');

        function hideAllSubmenus() {
            scheduleSubmenuRow.classList.add('d-none');
            paySubmenuRow.classList.add('d-none');
            workSubmenuRow.classList.add('d-none');
            memberSubmenuRow.classList.add('d-none');

            scheduleMenuLink.classList.remove('active');
            payMenuLink.classList.remove('active');
            workMenuLink.classList.remove('active');
            memberMenuLink.classList.remove('active');

            resetSubmenuPositions();
        }

        hideAllSubmenus();

        if (isSchedulePage) {
            scheduleSubmenuRow.classList.remove('d-none');
            scheduleMenuLink.classList.add('active');
            positionSubmenu(scheduleSubmenuRow, scheduleMenuLink);
        } else if (isPayPage) {
            paySubmenuRow.classList.remove('d-none');
            payMenuLink.classList.add('active');
            positionSubmenu(paySubmenuRow, payMenuLink);
        } else if (isWorkPage) {
            workSubmenuRow.classList.remove('d-none');
            workMenuLink.classList.add('active');
            positionSubmenu(workSubmenuRow, workMenuLink);
        } else if (isMemberPage) {
            memberSubmenuRow.classList.remove('d-none');
            memberMenuLink.classList.add('active');
            positionSubmenu(memberSubmenuRow, memberMenuLink);
        }

        /* ===== 상위 메뉴 클릭 시 기본 하위 메뉴로 바로 이동 ===== */
        scheduleMenuLink.addEventListener('click', function (e) {
            e.preventDefault();
            window.location.href = '/members/schedulemanagementbyweek';  // 주간일정
        });

        workMenuLink.addEventListener('click', function (e) {
            e.preventDefault();
            window.location.href = '/members/showworktimedashboard';     // (주간)조회
        });

        payMenuLink.addEventListener('click', function (e) {
            e.preventDefault();
            window.location.href = '/payment';                           // (개별)급여관리
        });

        memberMenuLink.addEventListener('click', function (e) {
            e.preventDefault();
            window.location.href = '/members';                           // 조회
        });

        // ===== "실시간현황" 등 다른 상위 메뉴 클릭 시 서브메뉴 모두 닫기 =====
        mainMenuLinks.forEach(function (link) {
            link.addEventListener('click', function () {
                if (this === scheduleMenuLink ||
                        this === payMenuLink ||
                        this === workMenuLink ||
                        this === memberMenuLink) {
                    // 위에서 별도 처리하므로 여기서는 패스
                    return;
                }
                hideAllSubmenus();
            });
        });
    });
</script>

